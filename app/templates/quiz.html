{% extends 'base.html' %}

{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
$(document).ready(function() {
    const countdownDuration = 35;
    let timeout;

    function startCountdown() {
        let timeRemaining = countdownDuration;
        updateTimerDisplay(timeRemaining);

        timeout = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay(timeRemaining);

            if (timeRemaining <= 0) {
                clearInterval(timeout);
                document.getElementById('nextQuestionForm').submit(); // Submit form traditionally when time's up
            }
        }, 1000);
    }

    function updateTimerDisplay(time) {
        $('#countdownTimer').text(`${time} ${time > 1 ? 'seconds' : 'second'}`);
        if(time <= 0) {
            $('#countdownTimer').text("{{ 'Time\'s up!' if session['lang'] == 'en' else 'Temps écoulé !' }}");
        }
    }

    startCountdown();
});

function validateForm() {
    const validationAlert = document.getElementById('validationAlert');
    if (!document.querySelector('input[name="choice"]:checked')) {
        validationAlert.classList.remove('d-none');
        validationAlert.textContent = "{{ 'Please select an option.' if session['lang'] == 'en' else 'Veuillez sélectionner une option.' }}";
        return false;
    }
    validationAlert.classList.add('d-none');
    return true;
}

document.getElementById('skipBtn').addEventListener('click', function() {
    document.getElementById('nextQuestionForm').submit();
});
</script>
<div class="container my-5 quiz-container">
    <h2 class="mb-3">{{ "Quiz Game" if session['lang'] == 'en' else "Jeu Quiz" }}</h2>
  
    <!-- Dynamic filter form for question sets -->
    <form action="{{ url_for('main.quiz') }}" method="get" class="mb-3">
        {{ form.csrf_token }}
        <select name="filter" class="form-select" onchange="this.form.submit()">
            <option value="questions.json">{{ "Default Set" if session['lang'] == 'en' else "Jeu par défaut" }}</option>
            <option value="questions2.json">{{ "Set 2" if session['lang'] == 'en' else "Jeu 2" }}</option>
            <option value="questions3.json">{{ "Set 3" if session['lang'] == 'en' else "Jeu 3" }}</option>
        </select>
    </form>

    {% if feedback %}
    <div class="alert {{ 'alert-success' if feedback.startswith("Correct answer") else 'alert-danger' }}" role="alert">
        {{ feedback }}
    </div>
    {% endif %}
    <form id="nextQuestionForm" action="{{ url_for('main.quiz') }}" method="post" onsubmit="return validateForm();">
        {{ form.csrf_token }}
        <fieldset class="mb-4">
            <legend class="form-label"><strong>{{ question.question }}</strong></legend>
            <div id="validationAlert" class="alert alert-warning d-none"></div>
            {% for choice in form.choice %}
            <div class="form-check">
                {{ choice(class_="form-check-input") }}
                <!-- Correctly associate the label with the input using choice.id -->
                <label class="form-check-label" for="{{ choice.id }}">
                    {{ choice.label.text }} <!-- Render the text of the choice -->
                </label>
            </div>
            {% endfor %}
        </fieldset>
        {{ form.question_id }}
        <div class="d-flex justify-content-between align-items-center">
            {{ form.submit(class="btn btn-primary") }}
            <button type="button" id="skipBtn" class="btn btn-secondary">{{ "Skip" if session['lang'] == 'en' else "Passer" }}</button>
        </div>
    </form>
    

        <div class="mt-4">
            <p>Time remaining: <span id="countdownTimer"></span></p>
            <p>{{ "Tips: Selecting an option will not pause the countdown." if session['lang'] == 'en' else "Conseil : Sélectionner une option ne mettra pas en pause le compte à rebours." }}</p>

        </div>
<!--
            <div>{{ "Number of correct answers:" if session['lang'] == 'en' else "Nombre de bonnes réponses :" }} {{ session.get('correct_answers', 0) }}</div>
            <div>{{ "Number of wrong answers:" if session['lang'] == 'en' else "Nombre de mauvaises réponses :" }} {{ session.get('wrong_answers', 0) }}</div>
            <div>{{ "Number of skipped questions:" if session['lang'] == 'en' else "Nombre de questions passées :" }} {{ session.get('skipped_answers', 0) }}</div>
        </div>
-->
    
</div>
{% endblock %}
