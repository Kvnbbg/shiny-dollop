{% extends 'base.html' %}

{% block content %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    let countdownDuration = 15; // Countdown duration in seconds
    let countdownTimer = document.getElementById("countdownTimer");
    let timeout;

    function startCountdown(duration) {
        let timeRemaining = duration;
        countdownTimer.textContent = timeRemaining.toString();
        timeout = setInterval(function() {
            timeRemaining--;
            countdownTimer.textContent = timeRemaining.toString();
            if (timeRemaining <= 0) {
                clearInterval(timeout);
                document.getElementById("nextQuestionForm").submit();
            }
        }, 1000);
    }

    startCountdown(countdownDuration);

    document.querySelectorAll('input[name="choice"]').forEach(function(input) {
        input.addEventListener('change', function() {
            clearInterval(timeout);
            document.querySelectorAll('.form-check-input').forEach((input) => {
                if(input.checked) {
                    input.parentNode.classList.add("selected");
                } else {
                    input.parentNode.classList.remove("selected");
                }
            });
            countdownTimer.textContent = 'Paused';
        });
    });
    
    document.getElementById("submitBtn").addEventListener('click', function() {
        validateForm() && clearInterval(timeout);
    });
});

function validateForm() {
    let radios = document.getElementsByName('choice');
    let formValid = false;

    for (let radio of radios) {
        if (radio.checked) {
            formValid = true;
            break;
        }
    }

    if (!formValid) {
        let validationAlert = document.getElementById('validationAlert');
        validationAlert.classList.remove('d-none');
        validationAlert.textContent = "{{ 'Please select an option.' if session['lang'] == 'en' else 'Veuillez s√©lectionner une option.' }}";
    }
    return formValid;
}
</script>

<div class="container mt-5">
  <h2 class="mb-4">{{ "Quiz App" if session['lang'] == 'en' else "Quiz App" }}</h2>

  {% if feedback %}
  <div class="alert {{ 'alert-success' if feedback.startswith("Correct answer") else 'alert-danger' }}" role="alert">
    {{ feedback }}
  </div>
  {% endif %}

  <form id="nextQuestionForm" action="{{ url_for('main.quiz') }}" method="post" onsubmit="return validateForm()">
    {{ form.csrf_token }}
    <div class="mb-3">
      <label class="form-label"><strong>{{ question.question }}</strong></label>
      <div id="validationAlert" class="alert alert-warning d-none"></div>
      <fieldset>
        {% for choice in question.choices %}
        <div class="form-check">
          <input class="form-check-input" type="radio" name="choice" id="choice{{ loop.index }}" value="{{ choice }}" required>
          <label class="form-check-label" for="choice{{ loop.index }}">{{ choice }}</label>
        </div>
        {% endfor %}
      </fieldset>
    </div>
    <input type="hidden" name="question_id" value="{{ question_id }}" />
    <button id="submitBtn" type="submit" class="btn btn-primary">{{ "Submit" if session['lang'] == 'en' else "Soumettre" }}</button>
  </form>

  <p class="mt-4">Time remaining: <span id="countdownTimer"></span> seconds</p>
  <p class="mt-4">{{ "Tips: Click on a question to pause the countdown" if session['lang'] == 'en' else "Tips: Vous pouvez mettre en pause en cliquant sur une question" }}</p>

</div>
{% endblock %}
