{% extends 'base.html' %} {% block content %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const countdownDuration = 35;
      let timeout;
  
      // Starts the countdown timer
      function startCountdown() {
        let timeRemaining = countdownDuration;
        updateTimerDisplay(timeRemaining);
  
        timeout = setInterval(() => {
          timeRemaining--;
          updateTimerDisplay(timeRemaining);
  
          // Submit the form traditionally when time's up
          if (timeRemaining <= 0) {
            clearInterval(timeout);
            document.getElementById("nextQuestionForm").submit();
          }
        }, 1000);
      }
  
      // Updates the display of the countdown timer
      function updateTimerDisplay(time) {
        const countdownTimer = document.getElementById("countdownTimer");
        countdownTimer.textContent = `${time} ${time > 1 ? "seconds" : "second"}`;
        if (time <= 0) {
          // Use |tojson filter for safe string handling
          countdownTimer.textContent = {{ "Time is up!" if session['lang'] == 'en' else 'Temps écoulé !' | tojson }};
        }
      }
  
      // Validates the form before submitting
      function validateForm() {
        const validationAlert = document.getElementById("validationAlert");
        if (!document.querySelector('input[name="choice"]:checked')) {
          validationAlert.classList.remove("d-none");
          // Use |tojson filter for safe string handling
          validationAlert.textContent = {{ 'Please select an option.' if session['lang'] == 'en' else 'Veuillez sélectionner une option.' | tojson }};
          return false;
        }
        validationAlert.classList.add("d-none");
        return true;
      }
  
      // Attach event listener to skip button for submitting the form
      document.getElementById("skipBtn").addEventListener("click", function () {
        document.getElementById("nextQuestionForm").submit();
      });
  
      // Start the countdown when the document is fully loaded
      startCountdown();
    });
  </script>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <h2 class="text-center mb-5">{{ "Good luck !" if session['lang'] == 'en' else "Bonne chance !" }}</h2>
        
        <!-- Filter Form for Question Sets -->
        <div class="card mb-4">
          <div class="card-header">
            <h4 class="mb-0">{{ "Select Question Set" if session['lang'] == 'en' else "Sélectionnez le jeu de questions" }}</h4>
          </div>
          <div class="card-body">
            <form action="{{ url_for('main.quiz') }}" method="get">
              {{ form.hidden_tag() }}
              <div class="d-flex justify-content-between">
                <select name="filter" class="form-select" onchange="this.form.submit()">
                  <option value="questions.json">{{ "Default Set" if session['lang'] == 'en' else "Jeu par défaut" }}</option>
                  <option value="questions2.json">{{ "Set 2" if session['lang'] == 'en' else "Jeu 2" }}</option>
                  <option value="questions3.json">{{ "Set 3" if session['lang'] == 'en' else "Jeu 3" }}</option>
                </select>
              </div>
            </form>
          </div>
        </div>
  
        <!-- Quiz Form -->
        <div class="card shadow-sm">
          <div class="card-body">
            <form id="nextQuestionForm" action="{{ url_for('main.quiz') }}" method="post" onsubmit="return validateForm();">
              {{ form.hidden_tag() }}
              <fieldset class="mb-3">
                <legend class="form-label mb-3">{{ question.question }}</legend>
                <div id="validationAlert" class="alert alert-warning d-none"></div>
                {% for choice in form.choice %}
                <div class="form-check">
                  {{ choice(class_="form-check-input") }}
                  <label class="form-check-label" for="{{ choice.id }}">{{ choice.label.text }}</label>
                </div>
                {% endfor %}
              </fieldset>
              {{ form.question_id }}
              <div class="d-flex justify-content-between">
                {{ form.submit(class="btn btn-primary") }}
                <button type="button" id="skipBtn" class="btn btn-outline-secondary">{{ "Skip" if session['lang'] == 'en' else "Passer" }}</button>
              </div>
            </form>
          </div>
        </div>
        
        <div class="text-center mt-4">
          <p>⏱️ <span id="countdownTimer"></span></p>
        </div>
      </div>
    </div>
  </div>
  {% endblock %}
  